"use strict";exports.id=782,exports.ids=[782],exports.modules={1312(e,t,n){n.d(t,{EventStreamSerde:()=>r});var s=n(118),i=n(87);class r{marshaller;serializer;deserializer;serdeContext;defaultContentType;constructor({marshaller:e,serializer:t,deserializer:n,serdeContext:s,defaultContentType:i}){this.marshaller=e,this.serializer=t,this.deserializer=n,this.serdeContext=s,this.defaultContentType=i}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:n}){const s=this.marshaller,i=t.getEventStreamMember(),r=t.getMemberSchema(i),o=this.serializer,a=this.defaultContentType,l=Symbol("initialRequestMarker"),c={async*[Symbol.asyncIterator](){if(n){const e={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:a}};o.write(t,n);const s=o.flush();yield{[l]:!0,headers:e,body:s}}for await(const t of e)yield t}};return s.serialize(c,e=>{if(e[l])return{headers:e.headers,body:e.body};const t=Object.keys(e).find(e=>"__type"!==e)??"",{additionalHeaders:n,body:s,eventType:i,explicitPayloadContentType:o}=this.writeEventBody(t,r,e);return{headers:{":event-type":{type:"string",value:i},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:o??a},...n},body:s}})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:n}){const i=this.marshaller,r=t.getEventStreamMember(),o=t.getMemberSchema(r).getMemberSchemas(),a=Symbol("initialResponseMarker"),l=i.deserialize(e.body,async e=>{const n=Object.keys(e).find(e=>"__type"!==e)??"",i=e[n].body;if("initial-response"===n){const e=await this.deserializer.read(t,i);return delete e[r],{[a]:!0,...e}}if(n in o){const t=o[n];if(t.isStructSchema()){const r={};let o=!1;for(const[a,l]of t.structIterator()){const{eventHeader:t,eventPayload:c}=l.getMergedTraits();if(o=o||Boolean(t||c),c)l.isBlobSchema()?r[a]=i:l.isStringSchema()?r[a]=(this.serdeContext?.utf8Encoder??s.P)(i):l.isStructSchema()&&(r[a]=await this.deserializer.read(l,i));else if(t){const t=e[n].headers[a]?.value;null!=t&&(l.isNumericSchema()?r[a]=t&&"object"==typeof t&&"bytes"in t?BigInt(t.toString()):Number(t):r[a]=t)}}if(o)return{[n]:r};if(0===i.byteLength)return{[n]:{}}}return{[n]:await this.deserializer.read(t,i)}}return{$unknown:e}}),c=l[Symbol.asyncIterator](),y=await c.next();if(y.done)return l;if(y.value?.[a]){if(!t)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(const[e,t]of Object.entries(y.value))n[e]=t}return{async*[Symbol.asyncIterator](){for(y?.value?.[a]||(yield y.value);;){const{done:e,value:t}=await c.next();if(e)break;yield t}}}}writeEventBody(e,t,n){const s=this.serializer;let r,o=e,a=null;const l={};if(t.getSchema()[4].includes(e)){const i=t.getMemberSchema(e);if(!i.isStructSchema())throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.");for(const[t,s]of i.structIterator()){const{eventHeader:i,eventPayload:r}=s.getMergedTraits();if(r)a=t;else if(i){const i=n[e][t];let r="binary";s.isNumericSchema()?r=(-2)**31<=i&&i<=2**31-1?"integer":"long":s.isTimestampSchema()?r="timestamp":s.isStringSchema()?r="string":s.isBooleanSchema()&&(r="boolean"),null!=i&&(l[t]={type:r,value:i},delete n[e][t])}}if(null!==a){const t=i.getMemberSchema(a);t.isBlobSchema()?r="application/octet-stream":t.isStringSchema()&&(r="text/plain"),s.write(t,n[e][a])}else s.write(i,n[e])}else{const[t,i]=n[e];o=t,s.write(15,i)}const c=s.flush();return{body:"string"==typeof c?(this.serdeContext?.utf8Decoder??i.a)(c):c,eventType:o,explicitPayloadContentType:r,additionalHeaders:l}}}}};